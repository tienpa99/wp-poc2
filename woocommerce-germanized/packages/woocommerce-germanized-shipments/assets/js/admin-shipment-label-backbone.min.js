window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(s){window.germanized.admin.shipment_label_backbone={params:{},init:function(){var e=germanized.admin.shipment_label_backbone;e.params=wc_gzd_admin_shipment_label_backbone_params,s(document).on("click",".germanized-create-label .show-further-services",e.onExpandServices).on("click",".germanized-create-label .show-fewer-services",e.onHideServices).on("click",".germanized-create-label .notice .notice-dismiss",e.onRemoveNotice).on("change",".germanized-create-label #product_id",e.onChangeProductId).on("change",".germanized-create-label :input:visible[id]",e.onChangeField),s(document.body).on("wc_backbone_modal_loaded",e.backbone.init).on("wc_backbone_modal_response",e.backbone.response)},parseFieldId:function(e){return e.replace("[","_").replace("]","")},onChangeField:function(){var e,n=germanized.admin.shipment_label_backbone,i=s(".germanized-create-label"),n=n.parseFieldId(s(this).attr("id")),a=s(this).val();s(this).hasClass("show-if-trigger")?0<(e=i.find(s(this).data("show-if"))).length&&(s(this).is(":checked")?e.show():e.hide(),s(document.body).trigger("wc_gzd_shipment_label_show_if")):(i.find(":input[data-show-if-"+n+"]").parents(".form-field").hide(),s(this).is(":checkbox")?s(this).is(":checked")&&i.find(":input[data-show-if-"+n+"]").parents(".form-field").show():i.find(":input[data-show-if-"+n+'*="'+a+'"]').parents(".form-field").show())},onChangeProductId:function(){germanized.admin.shipment_label_backbone.showOrHideByProduct(s(this).val())},showOrHideByProduct:function(a){s(".germanized-create-label").find("p.form-field :input[data-products-supported]").each(function(){var e=s(this),n=!0,i=e.data("products-supported").split(",");(n=-1!==s.inArray(a,i)?!1:n)?e.parents(".form-field").hide():e.parents(".form-field").show()})},onRemoveNotice:function(){s(this).parents(".notice").slideUp(150,function(){s(this).remove()})},onExpandServices:function(){var e=s(this).parents(".germanized-create-label").find(".show-if-further-services"),n=s(this).parents(".show-services-trigger");return e.show(),e.find(":input:visible").trigger("change"),n.find(".show-further-services").hide(),n.find(".show-fewer-services").show(),!1},onHideServices:function(){var e=s(this).parents(".germanized-create-label").find(".show-if-further-services"),n=s(this).parents(".show-services-trigger");return e.hide(),n.find(".show-further-services").show(),n.find(".show-fewer-services").hide(),!1},backbone:{getShipmentId:function(e){return e.replace(/^\D+/g,"")},init:function(e,n){var i,a,t;-1!==n.indexOf("wc-gzd-modal-create-shipment-label")&&(i=germanized.admin.shipment_label_backbone.backbone,a=germanized.admin.shipment_label_backbone,t=s(".germanized-create-label").parents(".wc-backbone-modal-content"),n={action:"woocommerce_gzd_create_shipment_label_form",shipment_id:i.getShipmentId(n),security:a.params.create_label_form_nonce},i.doAjax(n,t,i.onInitForm))},onAjaxSuccess:function(e){},onAjaxError:function(e){},doAjax:function(e,n,i,a){var t=germanized.admin.shipment_label_backbone.backbone,o=germanized.admin.shipment_label_backbone,r=n.find(".germanized-create-label");i=i||t.onAjaxSuccess,a=a||t.onAjaxError,e.hasOwnProperty("shipment_id")||(e.shipment_id=s("#wc-gzd-shipment-label-admin-shipment-id").val()),n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.find(".notice-wrapper").empty(),s.ajax({type:"POST",url:o.params.ajax_url,data:e,success:function(e){e.success?(e.fragments&&s.each(e.fragments,function(e,n){s(e).replaceWith(n)}),n.unblock(),i.apply(r,[e])):(n.unblock(),a.apply(r,[e]),t.printNotices(r,e.messages),r.animate({scrollTop:0},500))},error:function(e){},dataType:"json"})},onInitForm:function(e){var n=germanized.admin.shipment_label_backbone.backbone,e=e.shipment_id,i=s(".germanized-create-label");s(document.body).trigger("wc-enhanced-select-init"),s(document.body).trigger("wc-init-datepickers"),s(document.body).trigger("init_tooltips"),s(document.body).trigger("wc_gzd_shipment_label_after_init"),i.find(":input:visible").trigger("change"),i.parents(".wc-backbone-modal").on("click","#btn-ok",{shipmentId:e},n.onSubmit),i.parents(".wc-backbone-modal").on("touchstart","#btn-ok",{shipmentId:e},n.onSubmit),i.parents(".wc-backbone-modal").on("keydown",{shipmentId:e},n.onKeyDown)},getFormData:function(e){var i={};return hideService=!1,e.find(".show-if-further-services").is(":visible")||(e.find(".show-if-further-services").show(),hideService=!0),s.each(e.find(":input:visible").serializeArray(),function(e,n){-1!==n.name.indexOf("[]")?(n.name=n.name.replace("[]",""),i[n.name]=s.makeArray(i[n.name]),i[n.name].push(n.value)):i[n.name]=n.value}),hideService&&e.find(".show-if-further-services").hide(),i},printNotices:function(a,e){var t=germanized.admin.shipment_label_backbone.backbone;s.each(e,function(i,e){s.each(e,function(e,n){t.addNotice(n,"soft"===i?"warning":i,a)})})},onSubmitSuccess:function(e){var n=germanized.admin.shipment_label_backbone.backbone,i=s(this).parents(".wc-backbone-modal-content"),a=e.shipment_id,t=i.find(".germanized-create-label");e.messages.hasOwnProperty("error")||e.messages.hasOwnProperty("soft")?(n.printNotices(t,e.messages),i.find("footer").find("#btn-ok").addClass("modal-close").attr("id","btn-close").text(germanized.admin.shipment_label_backbone.params.i18n_modal_close)):i.find(".modal-close").trigger("click"),0<s("div#shipment-"+a).length&&germanized.admin.shipments.initShipment(a)},onKeyDown:function(e){var n=germanized.admin.shipment_label_backbone.backbone;13!==(e.keyCode||e.which)||e.target.tagName&&("input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase())||n.onSubmit.apply(s(this).find("button#btn-ok"),[e])},onSubmit:function(e){var n=germanized.admin.shipment_label_backbone.backbone,i=germanized.admin.shipment_label_backbone,a=e.data.shipmentId,t=s(this).parents(".wc-backbone-modal-content"),o=t.find(".germanized-create-label").find("form"),o=n.getFormData(o);o.security=i.params.create_label_nonce,o.shipment_id=a,o.action="woocommerce_gzd_create_shipment_label",n.doAjax(o,t,n.onSubmitSuccess),e.preventDefault(),e.stopPropagation()},addNotice:function(e,n,i){i.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},response:function(e,n,i){n.indexOf("wc-gzd-modal-create-shipment-label")}}},s(document).ready(function(){germanized.admin.shipment_label_backbone.init()})}(jQuery);