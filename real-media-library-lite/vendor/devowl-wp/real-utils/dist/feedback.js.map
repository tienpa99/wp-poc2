{"version":3,"file":"feedback.js","mappings":"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","sources":["webpack://devowl-local-files/real-utils/others/webpack/bootstrap","webpack://devowl-local-files/real-utils/others/webpack/runtime/compat get default export","webpack://devowl-local-files/real-utils/others/webpack/runtime/define property getters","webpack://devowl-local-files/real-utils/others/webpack/runtime/hasOwnProperty shorthand","webpack://devowl-local-files/real-utils/others/external var \"jQuery\"","webpack://devowl-local-files/real-utils/others/external var \"devowlWp_utils\"","webpack://devowl-local-files/real-utils/others/src/utils/index.tsx","webpack://devowl-local-files/real-utils/others/src/utils/request.tsx","webpack://devowl-local-files/real-utils/others/src/utils/i18n.tsx","webpack://devowl-local-files/real-utils/others/src/wp-api/feedback.post.tsx","webpack://devowl-local-files/real-utils/others/src/others/feedbackPointer.tsx","webpack://devowl-local-files/real-utils/others/src/feedback.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = jQuery;","const __WEBPACK_NAMESPACE_OBJECT__ = devowlWp_utils;","/* istanbul ignore file: this file does not contain any logic, only factory calls */\n\nimport { BaseOptions } from \"@devowl-wp/utils\";\n\n/**\n * As we do not rely on a real store in our package (should be lightweight)\n * we can use the window object as variable.\n */\n\nconst getStaticOptions = () => window[BaseOptions.getPureSlug(process.env.slug, true)].others;\nexport { getStaticOptions };\nexport * from \"./request\";\nexport * from \"./i18n\";","/* istanbul ignore file: this file does not contain any logic, only factory calls */\n\nimport { createRequestFactory, BaseOptions } from \"@devowl-wp/utils\";\n\n// Only needed once per `window`\nlet FACTORY_MEMO;\nfunction get() {\n  return FACTORY_MEMO ? FACTORY_MEMO : FACTORY_MEMO = createRequestFactory(window[BaseOptions.getPureSlug(process.env.slug, true)]);\n}\nconst urlBuilder = function () {\n  return get().urlBuilder(...arguments);\n};\nconst request = function () {\n  return get().request(...arguments);\n};\nexport { urlBuilder, request };","/* istanbul ignore file: this file does not contain any logic, only factory calls */\n\nimport { createLocalizationFactory } from \"@devowl-wp/utils\";\n\n// Only needed once per `window`\nlet FACTORY_MEMO;\nfunction get() {\n  return FACTORY_MEMO ? FACTORY_MEMO : FACTORY_MEMO = createLocalizationFactory(`${process.env.rootSlug}-${process.env.slug}`);\n}\nconst _n = function () {\n  return get()._n(...arguments);\n};\nconst _nx = function () {\n  return get()._nx(...arguments);\n};\nconst _x = function () {\n  return get()._x(...arguments);\n};\nconst __ = function () {\n  return get().__(...arguments);\n};\nconst _i = function () {\n  return get()._i(...arguments);\n};\nexport { _n, _nx, _x, __, _i };","import { RouteHttpVerb } from \"@devowl-wp/utils\";\nexport const locationRestFeedbackPost = {\n  path: \"/feedback/:slug\",\n  method: RouteHttpVerb.POST\n};","import { getStaticOptions, __, request } from \"../utils\";\nimport $ from \"jquery\";\nimport { locationRestFeedbackPost } from \"../wp-api\";\nclass FeedbackPointer {\n  /* istanbul ignore next */\n  constructor(slug, href, $handler) {\n    this.slug = void 0;\n    this.href = void 0;\n    this.$handler = void 0;\n    this.slug = slug;\n    this.$handler = $handler;\n    this.href = href;\n    this.init();\n  }\n  async close(e) {\n    let skip = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    e.preventDefault();\n\n    // Indicate loading\n    this.$handler.pointer(\"widget\").find(\"input, .button\").attr(\"disabled\", \"disabled\");\n    if (!skip) {\n      const {\n        choice,\n        note,\n        email\n      } = this.getValidInput();\n      try {\n        choice !== \"none\" && (await request({\n          location: locationRestFeedbackPost,\n          request: {\n            reason: choice,\n            note,\n            email\n          },\n          params: {\n            slug: this.slug\n          }\n        }));\n      } catch (e) {\n        // Silence is golden.\n      } finally {\n        // Ignore any errors and redirect\n        window.open(this.href, \"_self\");\n      }\n    } else {\n      window.open(this.href, \"_self\");\n    }\n  }\n  buttons() {\n    const support = $(`<a class=\"button\" href=\"#\">${__(\"Contact support\")}</a>`).click(() => {\n      window.open(\"https://devowl.io/support/\", \"_blank\");\n    });\n    const skip = $(`<a class=\"button\" href=\"#\">${__(\"Skip & Deactivate\")}</a>`).click(e => {\n      this.close(e, true);\n    });\n    const deactivate = $(`<a class=\"hidden button button-primary\" href=\"#\">${__(\"Deactivate\")}</a>`).click(e => {\n      if (this.validate()) {\n        this.close(e, false);\n      }\n    });\n    return $('<div class=\"real-utils-pointer-buttons\" />').append(deactivate, skip, support);\n  }\n  validate() {\n    return this.validateNote() && this.validatePrivacy() && this.validateEmail();\n  }\n  validateNote() {\n    const skipNote = $(`[name=\"${this.slug}-skip-note\"]`).is(\":checked\");\n    const noticeNote = $(`.notice-${this.slug}-note`);\n    const {\n      choice,\n      note\n    } = this.getValidInput();\n    if (!skipNote && !note && [\"upgrade-to-pro\", \"temp\", \"none\"].indexOf(choice) === -1) {\n      noticeNote.show();\n      return false;\n    } else {\n      noticeNote.hide();\n    }\n    return true;\n  }\n  validatePrivacy() {\n    const privacyChecked = $(`[name=\"${this.slug}-privacy\"]`).is(\":checked\");\n    const noticePrivacy = $(`.notice-${this.slug}-privacy`);\n    const {\n      email\n    } = this.getValidInput();\n    if (email && !privacyChecked) {\n      noticePrivacy.show();\n      return false;\n    } else {\n      noticePrivacy.hide();\n    }\n    return true;\n  }\n  validateEmail() {\n    const noticeEmail = $(`.notice-${this.slug}-email`);\n    const {\n      email\n    } = this.getValidInput();\n    if (email && !/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/.test(email.toLowerCase())) {\n      noticeEmail.show();\n      return false;\n    } else {\n      noticeEmail.hide();\n    }\n    return true;\n  }\n  getValidInput() {\n    const choice = $(`[name=\"${this.slug}-deactivate-choice\"]:checked`).val();\n    const note = $(`[name=\"${this.slug}-note\"]`).val();\n    const email = note ? $(`[name=\"${this.slug}-email\"]`).val() : \"\";\n    if (!choice && note) {\n      return {\n        choice: \"other\",\n        note,\n        email\n      };\n    } else if (choice) {\n      return {\n        choice,\n        note,\n        email\n      };\n    }\n    return undefined;\n  }\n  init() {\n    const headline = __(\"Too bad you are leaving\");\n    const name = getStaticOptions().names[this.slug];\n    const desc = __(\"Please give us feedback why you deactivate <strong>%s</strong>.\", name);\n    const choices = {\n      \"upgrade-to-pro\": __(\"Upgrade to PRO Version\"),\n      \"not-working\": __(\"Plugin did not work\"),\n      \"missing-features\": __(\"Not the features I want\"),\n      incompatible: __(\"Incompatible with other themes or plugins\"),\n      \"missing-doc\": __(\"Lack of documentation\"),\n      \"found-better-plugin\": __(\"Found a better plugin\"),\n      temp: __(\"Temporary deactivation\"),\n      none: __(\"I do not want to give feedback\"),\n      other: __(\"Other\")\n    };\n    const $widget = this.$handler.pointer({\n      pointerClass: `wp-pointer real-utils-feedback-pointer`,\n      content: `<h3>${headline}</h3><p>${desc}</p>\n<fieldset>\n    ${Object.keys(choices).map(choice => `<label class=\"col-2\"><input type=\"radio\" name=\"${this.slug}-deactivate-choice\" value=\"${choice}\" /> ${choices[choice]}</label>`).join(\"\")}\n        <div class=\"clear\"></div>\n        <br />\n    <label class=\"${this.slug}-section-note\">\n        <strong>${__(\"What could we do better?\")}</strong>\n        <input type=\"text\" class=\"regular-text\" name=\"${this.slug}-note\" />\n        <div class=\"notice notice-${this.slug}-note notice-error notice-alt hidden\"><p>${__(\"Please enter a text here or check the box below.\")}</p></div>\n    </label>\n    <label class=\"${this.slug}-section-note\">\n        <input type=\"checkbox\" name=\"${this.slug}-skip-note\" /> ${__(\"I don't want to add a comment and hence not help to make %s better.\", name)}\n    </label>\n    <label class=\"${this.slug}-section-email\" style=\"display:none\">\n        <br /><strong>${__(\"Email for answer/solution (optional)?\")}</strong>\n        <input type=\"text\" class=\"regular-text\" name=\"${this.slug}-email\" />\n        <div class=\"notice notice-${this.slug}-email notice-error notice-alt hidden\"><p>${__(\"Please provide a valid email.\")}</p></div>\n    </label>\n    <label class=\"${this.slug}-section-email\" style=\"display:none\">\n        <input type=\"checkbox\" name=\"${this.slug}-privacy\" /> ${__('I would like to receive an answer for my issue. For this purpose I agree to the data processing of my feedback and my email address. I have read the devowl.io <a href=\"https://devowl.io/privacy-policy/\" target=\"_blank\">privacy policy</a> and agree to it.', name)}\n        <div class=\"notice notice-${this.slug}-privacy notice-error notice-alt hidden\"><p>${__(\"If you would like to be contacted by us, please accept the privacy policy. If you prefer not to be contacted, leave the email field blank.\")}</p></div>\n    </label>\n</fieldset>`,\n      buttons: this.buttons.bind(this)\n    }).pointer(\"open\").pointer(\"widget\");\n\n    // Listen to changes and show the \"Skip & Deactivate\" button\n    $widget.find(\"input\").on(\"input\", () => {\n      const valid = this.getValidInput();\n      const isNoneChoice = valid?.choice === \"none\";\n      $widget.find(\".button:eq(0)\").css(\"display\", valid ? \"inline-block\" : \"none\"); // .toggleClass does not work as expected, see jQuery bug tracker\n      $widget.find(\".button:eq(1)\").css(\"display\", !valid ? \"inline-block\" : \"none\");\n      $widget.find(\".button:eq(1)\").css(\"display\", !valid ? \"inline-block\" : \"none\");\n      $(`[name=\"${this.slug}-skip-note\"]`).parent().css(\"display\", valid?.note ? \"none\" : \"block\");\n      $(`.${this.slug}-section-email`).css(\"display\", valid?.note && !isNoneChoice ? \"block\" : \"none\");\n      $(`.${this.slug}-section-note`).css(\"display\", isNoneChoice ? \"none\" : \"block\");\n    });\n  }\n}\nexport { FeedbackPointer };","/* istanbul ignore file: we do not need to care about the entry point file as errors are detected through integration tests (E2E) */\n// @deprecated Use package `real-product-manager-wp-client` instead\n\nimport \"./style/feedback.scss\";\nimport $ from \"jquery\";\nimport { getStaticOptions } from \"./utils\";\nimport { FeedbackPointer } from \"./others\";\n$(document).on(\"click\", \"tr.active .row-actions .deactivate a\", function (e) {\n  const [slug] = $(this).parents(\"tr.active\").data(\"plugin\").split(\"/\");\n  if (getStaticOptions().names[slug]) {\n    const href = $(this).attr(\"href\");\n    new FeedbackPointer(slug, href, $(this));\n    e.preventDefault();\n    return false;\n  }\n  return true;\n});"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","jQuery","devowlWp_utils","getStaticOptions","window","BaseOptions","others","FACTORY_MEMO","createRequestFactory","createLocalizationFactory","__","arguments","locationRestFeedbackPost","path","method","RouteHttpVerb","FeedbackPointer","constructor","slug","href","$handler","this","init","async","e","skip","length","undefined","preventDefault","pointer","find","attr","open","choice","note","email","getValidInput","request","location","reason","params","buttons","support","click","close","deactivate","validate","append","validateNote","validatePrivacy","validateEmail","skipNote","is","noticeNote","indexOf","hide","show","privacyChecked","noticePrivacy","noticeEmail","test","toLowerCase","val","headline","name","names","desc","choices","incompatible","temp","none","other","$widget","pointerClass","content","keys","map","join","bind","on","valid","isNoneChoice","css","parent","document","parents","data","split"],"sourceRoot":""}