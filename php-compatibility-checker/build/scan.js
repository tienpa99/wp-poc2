!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.jQuery,n=e.n(t),r=Object.prototype.toString,o=Array.isArray||function(e){return"[object Array]"===r.call(e)};function s(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function p(e,t){return null!=e&&"object"==typeof e&&t in e}var a=RegExp.prototype.test,c=/\S/;var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},u=/\s*/,h=/\s+/,d=/\s*=/,f=/\s*\}/,w=/#|\^|\/|>|\{|&|=|!/;function g(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function v(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},g.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t,n,r,o=this.cache;if(o.hasOwnProperty(e))t=o[e];else{for(var i,a,c,l=this,u=!1;l;){if(e.indexOf(".")>0)for(i=l.view,a=e.split("."),c=0;null!=i&&c<a.length;)c===a.length-1&&(u=p(i,a[c])||(n=i,r=a[c],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(r))),i=i[a[c++]];else i=l.view[e],u=p(l.view,e);if(u){t=i;break}l=l.parent}o[e]=t}return s(t)&&(t=t.call(this.view)),t},v.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},v.prototype.parse=function(e,t){var n=this.templateCache,r=e+":"+(t||y.tags).join(":"),s=void 0!==n,p=s?n.get(r):void 0;return null==p&&(p=function(e,t){if(!e)return[];var n,r,s,p,l=!1,m=[],v=[],b=[],$=!1,x=!1,k="",E=0;function S(){if($&&!x)for(;b.length;)delete v[b.pop()];else b=[];$=!1,x=!1}function _(e){if("string"==typeof e&&(e=e.split(h,2)),!o(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(i(e[0])+"\\s*"),r=new RegExp("\\s*"+i(e[1])),s=new RegExp("\\s*"+i("}"+e[1]))}_(t||y.tags);for(var C,T,j,R,O,A,I=new g(e);!I.eos();){if(C=I.pos,j=I.scanUntil(n))for(var P=0,U=j.length;P<U;++P)p=R=j.charAt(P),function(e,t){return a.call(e,t)}(c,p)?(x=!0,l=!0,k+=" "):(b.push(v.length),k+=R),v.push(["text",R,C,C+1]),C+=1,"\n"===R&&(S(),k="",E=0,l=!1);if(!I.scan(n))break;if($=!0,T=I.scan(w)||"name",I.scan(u),"="===T?(j=I.scanUntil(d),I.scan(d),I.scanUntil(r)):"{"===T?(j=I.scanUntil(s),I.scan(f),I.scanUntil(r),T="&"):j=I.scanUntil(r),!I.scan(r))throw new Error("Unclosed tag at "+I.pos);if(O=">"==T?[T,j,C,I.pos,k,E,l]:[T,j,C,I.pos],E++,v.push(O),"#"===T||"^"===T)m.push(O);else if("/"===T){if(!(A=m.pop()))throw new Error('Unopened section "'+j+'" at '+C);if(A[1]!==j)throw new Error('Unclosed section "'+A[1]+'" at '+C)}else"name"===T||"{"===T||"&"===T?x=!0:"="===T&&_(j)}if(S(),A=m.pop())throw new Error('Unclosed section "'+A[1]+'" at '+I.pos);return function(e){for(var t,n=[],r=n,o=[],s=0,i=e.length;s<i;++s)switch((t=e[s])[0]){case"#":case"^":r.push(t),o.push(t),r=t[4]=[];break;case"/":o.pop()[5]=t[2],r=o.length>0?o[o.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],o=0,s=e.length;o<s;++o)(t=e[o])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(v))}(e,t),s&&n.set(r,p)),p},v.prototype.render=function(e,t,n,r){var o=this.getConfigTags(r),s=this.parse(e,o),i=t instanceof m?t:new m(t,void 0);return this.renderTokens(s,i,n,e,r)},v.prototype.renderTokens=function(e,t,n,r,o){for(var s,i,p,a="",c=0,l=e.length;c<l;++c)p=void 0,"#"===(i=(s=e[c])[0])?p=this.renderSection(s,t,n,r,o):"^"===i?p=this.renderInverted(s,t,n,r,o):">"===i?p=this.renderPartial(s,t,n,o):"&"===i?p=this.unescapedValue(s,t):"name"===i?p=this.escapedValue(s,t,o):"text"===i&&(p=this.rawValue(s)),void 0!==p&&(a+=p);return a},v.prototype.renderSection=function(e,t,n,r,i){var p=this,a="",c=t.lookup(e[1]);if(c){if(o(c))for(var l=0,u=c.length;l<u;++l)a+=this.renderTokens(e[4],t.push(c[l]),n,r,i);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(e[4],t.push(c),n,r,i);else if(s(c)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,r.slice(e[3],e[5]),(function(e){return p.render(e,t,n,i)})))&&(a+=c)}else a+=this.renderTokens(e[4],t,n,r,i);return a}},v.prototype.renderInverted=function(e,t,n,r,s){var i=t.lookup(e[1]);if(!i||o(i)&&0===i.length)return this.renderTokens(e[4],t,n,r,s)},v.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,""),o=e.split("\n"),s=0;s<o.length;s++)o[s].length&&(s>0||!n)&&(o[s]=r+o[s]);return o.join("\n")},v.prototype.renderPartial=function(e,t,n,r){if(n){var o=this.getConfigTags(r),i=s(n)?n(e[1]):n[e[1]];if(null!=i){var p=e[6],a=e[5],c=e[4],l=i;0==a&&c&&(l=this.indentPartial(i,c,p));var u=this.parse(l,o);return this.renderTokens(u,t,n,l,r)}}},v.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},v.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||y.escape,o=t.lookup(e[1]);if(null!=o)return"number"==typeof o&&r===y.escape?String(o):r(o)},v.prototype.rawValue=function(e){return e[1]},v.prototype.getConfigTags=function(e){return o(e)?e:e&&"object"==typeof e?e.tags:void 0},v.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!o(e)?e.escape:void 0};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){b.templateCache=e},get templateCache(){return b.templateCache}},b=new v;y.clearCache=function(){return b.clearCache()},y.parse=function(e,t){return b.parse(e,t)},y.render=function(e,t,n,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(o(s=e)?"array":typeof s)+'" was given as the first argument for mustache#render(template, view, partials)');var s;return b.render(e,t,n,r)},y.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return l[e]}))},y.Scanner=g,y.Context=m,y.Writer=v;var $=y;function x(e,t){const n=S(e),r=S(t),o=n.pop(),s=r.pop(),i=j(n,r);return 0!==i?i:o&&s?j(o.split("."),s.split(".")):o||s?o?-1:1:0}const k=(e,t,n)=>{A(n);const r=x(e,t);return R[n].includes(r)};x.validate=e=>"string"==typeof e&&/^[v\d]/.test(e)&&E.test(e),x.compare=k,x.satisfies=(e,t)=>{const n=t.match(/^([<>=~^]+)/),r=n?n[1]:"=";if("^"!==r&&"~"!==r)return k(e,t,r);const[o,s,i]=S(e),[p,a,c]=S(t);return 0===T(o,p)&&("^"===r?j([s,i],[a,c])>=0:0===T(s,a)&&T(i,c)>=0)};const E=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,S=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");const t=e.match(E);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},_=e=>"*"===e||"x"===e||"X"===e,C=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},T=(e,t)=>{if(_(e)||_(t))return 0;const[n,r]=((e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t])(C(e),C(t));return n>r?1:n<r?-1:0},j=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const r=T(e[n]||0,t[n]||0);if(0!==r)return r}return 0},R={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},O=Object.keys(R),A=e=>{if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===O.indexOf(e))throw new Error(`Invalid operator, expected one of ${O.join("|")}`)},{__:__}=wp.i18n;function I(e,t){const r=n()(`#${t.type}_${t.slug}`),o=n()("#result-template").html().toString(),s={...t,status:"error",custom_error:!0,response:e},i=$.render(o,s);r.replaceWith(i);let p=`${t.name} ${t.version}\n\n`;e.status&&(p+=`Scan status: ${e.status}\n`),e.message&&(p+=e.message+"\n"),e.errors&&e.errors.forEach((e=>{p+=e.message+"\n"})),p+="\n";const a=n()("#testResults").val(),c=a+(a.length?"\n\n\n":"")+p;n()("#testResults").val(c),n()("#wpe-pcc-codeable-data").val(Buffer.from(c).toString("base64"))}const P=n()(".wpe-progress-active"),U=n()(".wpe-pcc-progress-count");function D(){if(0===window.phpcompat.queue.length)return q(),n()("#wpe-pcc-download-report").show(),void n()(".wpe-pcc-information").show();const e=new Date;var t=window.phpcompat.queue.shift();void 0===t.retryAt||t.retryAt<=e?function(e,t){var r=`https://wptide.org/api/v1/audit/wporg/${e.type}/${e.slug}/${e.version}?reports=phpcs_phpcompatibilitywp`;(!1===window.phpcompat.xhr||[0,4].includes(window.phpcompat.xhr.readyState))&&(window.phpcompat.xhr=n().ajax(r,{dataType:"json",beforeSend:()=>{const t=n()(`#${e.type}_${e.slug}`);t.find(".spinner").length||n()('<span class="spinner"></span>').show().appendTo(t)}}).done((t=>{if("complete"===t.status)window.phpcompat.results.push({...e,...t}),function(e,t){const r=e.reports?.phpcs_phpcompatibilitywp?.report;if(!r)return void I({status:"failed",message:"No scan results found"},t);const o=n()(`#${t.type}_${t.slug}`),s=n()("#result-template").html().toString(),i={...t};i.status=0===r.totals.errors&&0===r.totals.warnings?"success":"error";const p=Object.keys(r.versions).sort(x);let a=`${t.name} ${t.version}\n\n`;i.php=[],i.reports=[],p.forEach((e=>{if(i.php.push({phpversion:e,passed:r.compatible.includes(e)}),r.incompatible.includes(e)){const t=[],n=r.versions[e].files,o=[];Object.keys(n).forEach((e=>{n[e].messages.length&&(o.push(function(e,t){const n=t.messages.reduce(((e,t)=>[`${t.line}`.length>e[0]?`${t.line}`.length:e[0],`${t.type}`.length>e[1]?`${t.type}`.length:e[1],`${t.message}`.length>e[2]?`${t.message}`.length:e[2]]),[0,0,0]),r=t.messages.reduce(((e,t)=>(-1===e.indexOf(t.line)&&e.push(t.line),e)),[]),o=t.messages.map((e=>` ${e.line.toString().padStart(n[0]," ")} | ${e.type.toString().padEnd(n[1]," ")} | ${e.message.toString().padEnd(n[2]," ")} `)),s=`FILE: ${e}`,i=`FOUND ${t.errors} ERRORS AND ${t.warnings} WARNINGS AFFECTING ${r.length} LINES`,p=Math.max(s.length,i.length,o[0].length),a=new Array(p+1).join("-");return`${s}\n${a}\n${i}\n${a}\n`+o.join("\n")+`\n${a}`}(e,n[e])),n[e].messages.forEach((n=>{t.push(`${e}:${n.line}\n${n.source}\n${n.message}`)})))}));const s=`PHP ${e} incompatibilities:\n\n`+o.join("\n\n")+"\n\n";a+=s,i.reports.push({phpversion:e,messages:[s]})}else a+=`Compatible with PHP ${e}\n`})),i.has_errors=!(0===r.totals.errors&&0===r.totals.warnings);const c=$.render(s,i);o.replaceWith(c);const l=n()("#testResults").val(),u=l+(l.length?"\n\n\n":"")+a;n()("#testResults").val(u);const h=new Blob([u],{type:"text/plain"}),d=new FileReader;d.readAsDataURL(h),d.onloadend=function(){const e=d.result.split(",")[1];n()("#wpe-pcc-codeable-data").val(e)}}(t,e),N();else if("pending"===t.status){const t=new Date;console.log("Report is pending, retry in 5 seconds"),e.retryAt=new Date(t.getTime()+5e3),window.phpcompat.queue.push(e)}else N(),I(t,e)})).fail((t=>{var n;N(),t.responseJSON||0!==t.status||0!==t.readyState?I(null!==(n=t.responseJSON)&&void 0!==n?n:{status:t.status,message:t.responseText},e):I({status:"failed",message:"The audit of this code was interrupted, please scan again."},e)})).always((()=>{D()})))}(t):(window.phpcompat.queue.push(t),window.phpcompat.ticker=setTimeout(D,1e3))}function N(){window.phpcompat.completed++,P.show(),U.text(`${window.phpcompat.completed} of ${window.phpcompat.total}`)}function q(){n()(".wpe-pcc-spinner").hide(),U.text(""),P.hide()}!function(e){if("undefined"==typeof checkerList)return;window.phpcompat={},window.phpcompat.queue=[],window.phpcompat.total=0,window.phpcompat.completed=0,window.phpcompat.xhr=!1,window.phpcompat.ticker=!1,window.phpcompat.results=[];const t=e("input[type=radio][name=active_plugins]"),r=e("#runButton");function o(t){var r=e("input[type=radio][name=active_plugins]:checked").val();(function(e,t){window.phpcompat.queue=[],window.phpcompat.results=[],window.phpcompat.total=0,window.phpcompat.completed=0,clearTimeout(window.phpcompat.ticker),window.phpcompat.xhr&&window.phpcompat.xhr.abort(),n()("#wpe-pcc-download-report").hide(),q(),n()("#testResults").val(""),e.plugins.forEach((e=>{"yes"!==e.active&&"no"!==t||window.phpcompat.queue.push({...e,type:"plugin"})})),e.themes.forEach((e=>{"yes"!==e.active&&"no"!==t||window.phpcompat.queue.push({...e,type:"theme"})})),window.phpcompat.total=window.phpcompat.queue.length})(t,r),function(e,t){const r=n()("#wpe_pcc_results"),o=n()("#result-template").html().toString();r.empty(),e.plugins.length&&(r.append("<h3>"+__("Plugins","wpe-php-compat")+"</h3>"),e.plugins.forEach((e=>{if("yes"===e.active||"no"===t){const t={...e,type:"plugin",status:"pending"},n=$.render(o,t);r.append(n)}}))),e.themes.length&&(r.append("<h3>"+__("Themes","wpe-php-compat")+"</h3>"),e.themes.forEach((e=>{if("yes"===e.active||"no"===t){const t={...e,type:"theme",status:"pending"},n=$.render(o,t);r.append(n)}}))),n()(".wpe-pcc-results").show()}(t,r)}function s(){e("#developermode").prop("checked",!1),e("#developerMode").hide(),e("#wpe_pcc_results").show()}o(checkerList),t.on("change",(function(){o(checkerList),r.prop("disabled",!1),s()})),e("#cleanupButton").on("click",(function(e){e.preventDefault(),r.prop("disabled",!1),s(),o(checkerList)})),r.on("click",(function(t){t.preventDefault(),D(),e(".wpe-pcc-spinner").show(),e(this).prop("disabled",!0)})),e(document).on("click",".wpe-pcc-php-version-errors",(function(t){t.preventDefault();const n=e(this).data("php-version"),r=e(this).closest(".wpe-pcc-alert").find("#wpe_pcc_reports").find(`[data-php-version="${n}"]`);e(".wpe-pcc-php-version-report").not(r).hide(),e(r).toggle()})),e(document).on("click",".wpe-pcc-php-version-report-close",(function(t){t.preventDefault(),e(this).closest(".wpe-pcc-php-version-report").hide()})),e("#developermode").on("change",(function(t){e(this).is(":checked")?(e("#developerMode").show(),e("#wpe_pcc_results").hide()):(e("#developerMode").hide(),e("#wpe_pcc_results").show())})),e("#downloadReport").on("click",(function(e){e.preventDefault(),function(){const e=n()("#testResults").val();if(e.length){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","report.txt"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}()}))}(n())}();