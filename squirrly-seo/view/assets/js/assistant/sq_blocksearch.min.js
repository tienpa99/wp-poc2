(function($){"use strict";if($.isFunction($.fn.sq_blocksearch)){return}$.fn.sq_blocksearch=function(options){var $this=this;var settings=$.extend({type:"img",delay:1e3,processing:null,timeout:null,ajaxCall:null,gtimeout:null},options);$.sq_fields=$.extend({sq_publish_alert:$this.find("#sq_publish_alert"),sq_more:$this.find(".sq_more"),sq_keywords_research_clear:$(".sq_keywords_research_clear"),sq_keywords_research_submit:$(".sq_keywords_research_submit")},$.sq_fields);$this.init=function(){if($.sq_config.keyword===""){$.sq_blockseo.close();$this.hideTypes()}};$this.hideTypes=function(){$.sq_fields.sq_types.hide();$this.hideSearch()};$this.showTypes=function(){$.sq_fields.sq_types.show()};$this.showActiveEditor=function(){var ed=$.sq_editor.getTinymceEditor();$.sq_tinymce.addEvents(ed)};$this.hideSearch=function(){$.sq_fields.sq_search.hide();$.sq_fields.sq_search_img_filter.hide()};$this.showSearch=function(){$.sq_fields.sq_search.html('<span class="sq_show_mgs">'+$.sq_config.__searching+"</span>");$.sq_fields.sq_search.show();$.sq_fields.sq_search_img_filter.hide()};$this.showNoResults=function(header,keyword){$this.showSearch();$.sq_fields.sq_search.addClass("sq_error").html('<span class="sq_show_mgs">'+$.sq_config.__nofound+"</span>");if(typeof header!=="undefined"&&typeof keyword!=="undefined"&&header===1){$this.addHeaderSearch(keyword)}};$this.addHeaderSearch=function(keyword){if(typeof keyword==="undefined")keyword="";if(!$.sq_fields.sq_search.find("#sq_search_second").length){$.sq_fields.sq_search.prepend('<div id="sq_search_second" style="display: none"><input type="text" id="sq_keyword_second" placeholder="Search for new keyword..." '+($.sq_strEqual($.sq_config.keyword,keyword)||keyword===""?'value=""':'value="'+keyword+'"')+' autocomplete="off"  /><input type="button" id="sq_keyword_second_check" value=">"/></div>')}$.sq_fields.sq_search_second=$this.find("#sq_search_second");$.sq_fields.sq_keyword_second=$this.find("#sq_keyword_second");$.sq_fields.sq_keyword_second_check=$this.find("#sq_keyword_second_check");if($.sq_strEqual($.sq_config.keyword,keyword)){if(!$.sq_fields.sq_search.find(".sq_search_notrelevant").length){$.sq_fields.sq_search.prepend('<a href="javascript:void(0);" class="sq_search_notrelevant">'+$.sq_config.__notrelevant+"</a>");$this.find(".sq_search_notrelevant").on("click",function(){$.sq_fields.sq_search_second.show();$.sq_fields.sq_keyword_second.focus();$(this).hide()})}}else{$.sq_fields.sq_search_second.show();$.sq_fields.sq_keyword_second.focus()}$this.initialFieldValue($.sq_fields.sq_keyword_second,"black","gray");$.sq_fields.sq_keyword_second.on("keypress",function(event){if(event.keyCode===$.ui.keyCode.ENTER)$.sq_fields.sq_keyword_second_check.trigger("click");return event.keyCode!==$.ui.keyCode.ENTER});$.sq_fields.sq_keyword_second_check.on("click",function(){if($.sq_fields.sq_keyword_second.val()!==""){$this.refreshSearch(settings.type)}})};$this.initialFieldValue=function(field,active_color,inactive_color){if(field.hasClass("default")){field.css("color",inactive_color);var default_values=[];field.focus(function(){if(!default_values[this.id]){default_values[this.id]=this.value}if($.sq_strEqual(this.value,default_values[this.id])){this.value="";this.style.color=active_color}$(this).blur(function(){if(this.value===""){this.style.color=inactive_color;this.value=default_values[this.id]}})})}};$this.getSearch=function(type,start,extra_params){var keyword;if($.sq_fields.sq_keyword_second.length>0&&$.sq_fields.sq_keyword_second.val()!==""){keyword=$.sq_fields.sq_keyword_second.val()}else{keyword=$.sq_config.keyword}var action="sla_customcall";var params="";var url="";if(typeof start==="undefined")start=0;if(start===0){$this.showSearch()}switch(type){case"img":if($.sq_fields.sq_search_img_nolicence.is(":checked")){url="api/research/ib/images";params="page="+(start/$.sq_config.nrb+1)+"&nrb="+$.sq_config.nrb+"&hl="+$.sq_config.language+"&q="+keyword}else{url="api/research/ib/gimages";params="page="+start+"&rpp="+$.sq_config.nrb+"&hl="+$.sq_config.language+'&q="'+keyword+'"'}break;case"twitter":url="api/research/ib/twitter";params="page="+(start/$.sq_config.nrb+1)+"&rpp="+$.sq_config.nrb+"&hl="+$.sq_config.language+"&q="+keyword;break;case"blog":url="api/research/ib/blog";params="page="+start+"&rpp="+$.sq_config.nrb+"&hl="+$.sq_config.language+'&q="'+keyword+'"';break;case"wiki":url="api/research/ib/wiki";params="&page="+(start/$.sq_config.nrb+1)+"&rpp="+$.sq_config.nrb+"&hl="+$.sq_config.language+"&q="+keyword;break;case"local":action="sq_ajax_search_blog";url="";params="nrb="+$.sq_config.nrb+"&sq_nonce="+$.sq_config.sq_nonce+"&exclude="+$.sq_config.postID+"&q="+keyword+"&start="+start;params="nrb="+$.sq_config.nrb+"&sq_nonce="+$.sq_config.sq_nonce+"&exclude="+$.sq_config.postID+"&q="+keyword+"&start="+start;break}if(typeof extra_params!=="undefined")params=params+"&"+extra_params;var cached=$.sq_getCache(url+params);if(cached){$this.showResults(keyword,cached,type,start)}else{settings.ajaxCall=$.post($.sq_config.ajaxurl,{action:action,sq_nonce:$.sq_config.sq_nonce,url:url,params:params}).done(function(response){$(".sq_show_mgs").remove();if(response instanceof Object){$this.showResults(keyword,response,type,start);$.sq_setCache(url+"?"+params,response)}else{$.sq_fields.sq_search.sq_doneloading().addClass("sq_error");if(start==0){$this.showNoResults(1,keyword)}else{$this.showNoResults(0)}}if(type==="img")$.sq_fields.sq_search_img_filter.show()}).fail(function(response){if(response.status===200&&response.responseText.indexOf("{")>0){response.responseText=response.responseText.substr(response.responseText.indexOf("{"),response.responseText.lastIndexOf("}"));try{response=$.parseJSON(response.responseText);if(response instanceof Object){$this.showResults(keyword,response,type,start);$.sq_setCache(url+params,response)}else{$.sq_fields.sq_search.sq_doneloading().addClass("sq_error");if(start===0){$this.showNoResults(1,keyword)}else{$this.showNoResults(0)}}if(type==="img")$.sq_fields.sq_search_img_filter.show()}catch(e){}}else{$.sq_fields.sq_search.sq_doneloading().addClass("sq_error");if(start===0){$this.showNoResults(1,keyword)}else{$this.showNoResults(0)}}if(type==="img")$.sq_fields.sq_search_img_filter.show()})}};$this.showResults=function(keyword,response,type,start){var items=[];var date;var domainName;$.sq_fields.sq_search.sq_doneloading().removeClass("sq_error");if(type==="img"){if(typeof response.data.responseData!=="undefined"&&typeof response.data.responseData.results!=="undefined"&&response.data.responseData.results.length>0){$.each(response.data.responseData.results,function(key,val){if(typeof val["detail"]!=="undefined"&&val["detail"]!==""){val["detail"]=val["detail"].replace(/\[a href=([^\]]*) title=([^\]]*)\]/,"$1")}items.push('<li class="sq_search_img_li" id="sq_search_img_li'+key+'" src="'+val["url"]+'" width="'+val["width"]+'" height="'+val["height"]+'" '+(typeof val["attribute"]!=="undefined"&&val["attribute"]!==""?'attribute="'+val["attribute"]+'"':"")+" >"+(typeof val["attribute"]!=="undefined"?val["attribute"]!==""?'<span class="sq_attribute" title="'+$.sq_config.__has_attributes+'">A</span>':'<span class="sq_attribute " title="'+$.sq_config.__no_attributes+'">N</span>':"")+'<img id="sq_search_img'+key+'" src="'+val["tbUrl"]+'" '+(typeof val["detail"]!=="undefined"&&val["detail"]!==""?'title="'+val["detail"]+'"':"")+' alt="'+val["contentNoFormatting"]+'" /></li>')})}else $this.showNoResults()}if(type==="twitter"){if(typeof response.data!=="undefined"&&response.data.length>0)$.each(response.data,function(key,val){date=new Date(val["created_at"]);date=$this.formatDate(date);items.push('<li class="sq_search_twitter_li sq_search_li" id="t_'+val["id"]+'" href="https://twitter.com/'+val["from_user"]+'"><a href="https://twitter.com/'+val["from_user"]+'" title="'+val["text"]+'" target="_blank" ><img src="'+val["profile_image_url"]+'" alt="'+val["from_user"]+'" class="sq_author_avatar" /></a><div class="sq_quote_content"><div class="sq_quote_author"><span class="sq_author_name">'+val["from_user"]+'</span></div> <div class="sq_quote_text truncated">'+val["text"]+'</div></div><div class="sq_info"><ul><li>'+$.sq_config.__date+": "+date+'</li></ul></div><div class="sq_attribution"><ul><li class="sq_insert">'+$.sq_config.__insertit+"</li></ul></div></li>")});else $this.showNoResults()}if(type==="blog"){if(typeof response!=="undefined"&&typeof response.data.results!=="undefined"&&response.data.results.length>0)$.each(response.data.results,function(key,val){domainName='<a href="'+val["url"]+'" target="_blank">'+val["visibleUrl"]+"</a>";items.push('<li class="sq_search_blog_li sq_search_li" id="b_'+key+'" href="'+val["url"]+'" header="'+val["titleNoFormatting"]+'" ><div class="sq_news_content"><div class="sq_news_title">'+val["titleNoFormatting"]+'</div><div class="sq_news_text">'+val["content"]+'</div><div class="sq_info"><ul><li>source: '+domainName+'</li></ul></div></div><div class="sq_attribution"><ul><li class="sq_read">'+$.sq_config.__readit+'</li><li class="sq_insert">'+$.sq_config.__insertasbox+'</li><li class="sq_reference">'+$.sq_config.__reference+"</li></ul></div></li>")});else $this.showNoResults()}if(type==="wiki"){var wikihref="//"+$.sq_config.language.substr(0,2)+".wikipedia.org/wiki/";if(typeof response.data.results!=="undefined"&&response.data.results.length>0)$.each(response.data.results,function(key,val){date=new Date(val.timestamp);date=$this.formatDate(date);items.push('<li class="sq_search_wiki_li sq_search_li" id="w_'+key+'" href="'+wikihref+val.title.replace(/ /g,"_")+'" ><div class="sq_wiki_content"><div class="sq_wiki_title">'+val.title+'</div><div class="sq_wiki_text truncated">'+val.snippet+'</div><div class="sq_info"><ul><li>'+$.sq_config.__date+": "+date+'</li></ul></div><div class="sq_attribution"><ul><li class="sq_read">'+$.sq_config.__readit+'</li><li class="sq_insert">'+$.sq_config.__insertit+"</li></ul></div></li>")});else $this.showNoResults()}if(type==="local"){if(typeof response.results!=="undefined"&&response.results.length>0)$.each(response.results,function(key,val){date=new Date(val.date);date=$this.formatDate(date);items.push('<li class="sq_search_local_li sq_search_li" id="l_'+val["id"]+'" href="'+val["url"]+'" header="'+val["title"]+'" ><div class="sq_local_content"><div class="sq_local_title">'+val["title"]+'</div><div class="sq_local_text truncated">'+val["content"]+'</div><div class="sq_info"><ul><li>'+$.sq_config.__date+": "+date+'</li></ul></div><div class="sq_attribution"><ul><li class="sq_insert">'+$.sq_config.__insertit+'</li><li class="sq_reference">'+$.sq_config.__reference+'</li><li class="sq_link">'+$.sq_config.__addlink+"</li></ul></div></li>")});else $this.showNoResults()}if(items.length>0){if(start===0){$.sq_fields.sq_search.append($("<ul/>",{html:items.join("")}));$this.addHeaderSearch(keyword)}else{$.sq_fields.sq_search.find("ul").first().append(items.join(""))}$this.addEvents("click",type,start)}else{if(start===0){$this.showNoResults(1,keyword)}else{$this.showNoResults(0)}}if($.sq_fields.sq_more.length>0){$.sq_fields.sq_more.html("<span />");$.sq_fields.sq_more.sq_doneloading();$.sq_fields.sq_more.on("click");if(items.length<$.sq_config.nrb)$.sq_fields.sq_more.hide()}$this.find(".sq_search li.sq_search_li .sq_attribution > ul").show()};$this.addEvents=function(event,type,start){if(type==="img"){$this.find("li.sq_search_img_li img").off(event).on(event,function(){if($.sq_isGutenberg()){var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(wp.blocks.createBlock("core/image",{url:$(this).parent("li").attr("src"),className:"sq_image",alt:$.sq_config.keyword.replace(/\"/g,"")}),undefined);$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packimg($(this).attr("id"),$(this).parent("li").attr("src"),$(this).parent("li")));if(typeof $(this).parent("li").attr("attribute")!=="undefined"&&typeof $.sq_config.__sq_photo_copyright!=="")$.sq_editor.insert($.sq_config.__sq_photo_copyright.replace("%s",$(this).parent("li").attr("attribute")))}});$this.find("li.sq_search_img_li img").on("dragstart",function(event){if($.sq_config.editor_type==="html"){event.originalEvent.dataTransfer.setData("text/plain",$(this).parent("li").html())}});$.sq_fields.sq_search_img_filter.show()}if(type==="twitter"){$this.find("li.sq_search_twitter_li .sq_insert").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packtweet($(this).parents("li:last"))});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packtweet($(this).parents("li:last")))}})}if(type==="wiki"){$this.find("li.sq_search_wiki_li .sq_insert").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packwiki($(this).parents("li:last"))});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packwiki($(this).parents("li:last")))}});$this.find(".sq_read").off(event).on(event,function(){$("body").after($.sq_fields.sq_blog_preview);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_title").html("&nbsp;");$.sq_fields.sq_blog_preview.find("#sq_blog_preview_body").html("");$.sq_fields.sq_blog_preview.find("#sq_blog_preview_close").off(event).on(event,function(){$.sq_fields.sq_blog_preview.remove()});$.sq_fields.sq_blog_preview.sq_loading("sq_loading");$this.previewBlog($(this).parents("li:last"),false)})}if(type==="news"||type==="blog"){$this.find("li.sq_search_blog_li .sq_insert").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packblog($(this).parents("li:last"),"box")});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packblog($(this).parents("li:last"),"box"))}});$this.find("li.sq_search_blog_li .sq_reference").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packblog($(this).parents("li:last"),"reference")});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packblog($(this).parents("li:last"),"reference"))}});$this.find(".sq_read").off(event).on(event,function(){$("body").after($.sq_fields.sq_blog_preview);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_title").html("&nbsp;");$.sq_fields.sq_blog_preview.find("#sq_blog_preview_body").html("");$.sq_fields.sq_blog_preview.find("#sq_blog_preview_close").off(event).on(event,function(){$.sq_fields.sq_blog_preview.remove()});$.sq_fields.sq_blog_preview.sq_loading("sq_loading");$this.previewBlog($(this).parents("li:last"),true)})}if(type==="local"){$this.find("li.sq_search_local_li .sq_insert").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packlocal($(this).parents("li:last"),"box")});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packlocal($(this).parents("li:last"),"box"))}});this.find("li.sq_search_local_li .sq_reference").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packlocal($(this).parents("li:last"),"reference")});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packlocal($(this).parents("li:last"),"reference"))}});this.find("li.sq_search_local_li .sq_link").off(event).on(event,function(){if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:$this.packlocal($(this).parents("li:last"),"link")});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click");$.sq_blockseo.callback()}else{$.sq_editor.insert($this.packlocal($(this).parents("li:last"),"link"))}})}if(start===0){$.sq_fields.sq_search.append('<div class="sq_more"><span /></div>');$.sq_fields.sq_more=$this.find(".sq_more")}$.sq_fields.sq_more.off("click").on("click",function(){$(this).html("");$(this).sq_loading();$(this).off("click");$this.getSearch(type,start+$.sq_config.nrb)})};$this.pack=function(html){return'<div class="sq_box">'+html+"<div>"};$this.packimg=function(id,src,parent){if(id!==""){var content='<img src="'+src+'" id="img'+Math.floor(Math.random()*1e3)+'" class="aligncenter size-medium sq_image" width="'+(parent.attr("width")>500?"500":parent.attr("width"))+'" alt="'+$.sq_config.keyword.replace(/\"/g,"")+'" title="'+$.sq_config.keyword.replace(/\"/g,"")+'" />';return content}return""};$this.packtweet=function(parent){var content="";content='<div class="sq_quote_content" style="position: relative;clear: both;background: white;font-size: 14px;color: #333;max-width: 500px;margin: 5px auto 5px auto;padding: 13px;border: 1px solid #DDD;-webkit-box-shadow: 0 1px 0 #DDD;-moz-box-shadow: 0 1px 0 #ddd;box-shadow: 0 1px 0 #DDD;">';content=content+'<a id="'+parent.attr("id")+'" class="sq_tweet" href="'+parent.attr("href")+'" title="'+parent.find(".sq_author_avatar").attr("alt")+'" style="display: block;float: left;width: 48px;height: 48px;padding: 1px;margin: 0;border: 1px solid #DDD;" ><img class="sq_author_avatar" src="'+parent.find(".sq_author_avatar").attr("src")+'" alt="'+parent.find(".sq_author_avatar").attr("alt")+'" /></a>';content=content+'<div class="sq_quote_text" style="margin-left: 62px;line-height: 1.5em;padding-left: 21px;min-height: 52px;font-style:italic;">'+parent.find(".sq_quote_text").html()+"</div>";content=content+"</div>";return'<div id="tw'+Math.floor(Math.random()*1e3)+'" >'+content+"</div>"+$.sq_config.after_insert};$this.packwiki=function(parent){var content="";content='<div class="sq_wiki_content" style="position: relative;clear: both;background: white;font-size: 14px;color: #333;max-width: 500px;margin: 5px auto 5px auto;padding: 13px;border: 1px solid #DDD;-webkit-box-shadow: 0 1px 0 #DDD;-moz-box-shadow: 0 1px 0 #ddd;box-shadow: 0 1px 0 #DDD;">';content=content+'<a id="'+parent.attr("id")+'" class="sq_wiki" href="'+parent.attr("href")+'" title="'+parent.find(".sq_wiki_title").html()+'" style="display: block;font-weight: 700;color: #0074B7;line-height: 1.4em;margin-bottom: 5px;text-decoration: none;">'+parent.find(".sq_wiki_title").html()+"</a>";content=content+'<div class="sq_wiki_text" style="font-style:italic;color: #333;">'+parent.find(".sq_wiki_text").html()+"</div>";content=content+"</div>";return'<div id="wi'+Math.floor(Math.random()*1e3)+'">'+content+"</div>"+$.sq_config.after_insert};$this.packblog=function(parent,as){var content="";if(as==="box"){content='<div class="sq_blog_content" style="position: relative;clear: both;background: white;font-size: 14px;color: #333;max-width: 500px;margin: 5px auto 5px auto;padding: 13px;border: 1px solid #DDD;-webkit-box-shadow: 0 1px 0 #DDD;-moz-box-shadow: 0 1px 0 #ddd;box-shadow: 0 1px 0 #DDD;">';content=content+'<a id="'+parent.attr("id")+'" class="sq_news" href="'+parent.attr("href")+'" title="'+parent.find(".sq_news_title").html()+'" >'+parent.find(".sq_news_title").html()+"</a>";content=content+'<div class="sq_news_text" style="font-style:italic;color: #333;">'+parent.find(".sq_news_text").html()+"</div>";content=content+"</div>"}if(as==="reference"){content='<a class="sq_news" href="'+parent.attr("href")+'" rel="nofollow" title="'+parent.attr("header")+'" style="font-style:italic;color: #333;">'+$.sq_getDomain(parent.attr("href"),[1,7,8,10])+"</a>"}return'<div id="bl'+Math.floor(Math.random()*1e3)+'">'+content+"</div>"+$.sq_config.after_insert};$this.packlocal=function(parent,as){var content="";if(as==="box"){content='<div class="sq_local_content" style="position: relative;clear: both;background: white;font-size: 14px;color: #333;max-width: 500px;margin: 5px auto 5px auto;padding: 13px;border: 1px solid #DDD;-webkit-box-shadow: 0 1px 0 #DDD;-moz-box-shadow: 0 1px 0 #ddd;box-shadow: 0 1px 0 #DDD;">';content=content+'<a id="'+parent.attr("id")+'" class="sq_local" href="'+parent.attr("href")+'" title="'+parent.find(".sq_local_title").html()+'" style="display: block;font-weight: 700;color: #0074B7;line-height: 1.4em;margin-bottom: 5px;text-decoration: none;">'+parent.find(".sq_local_title").html()+"</a>";content=content+'<div class="sq_local_text" style="font-style:italic;color: #333;">'+parent.find(".sq_local_text").html()+"</div>";content=content+"</div>";content='<div id="lo'+Math.floor(Math.random()*1e3)+'">'+content+"</div>"+$.sq_config.after_insert}if(as==="reference"){content='<a class="sq_local" href="'+parent.attr("href")+'" title="'+parent.attr("header")+'" >'+decodeURIComponent(parent.attr("href"))+"</a>";content='<div id="lo'+Math.floor(Math.random()*1e3)+'" style="font-style:italic;color: #333;">'+content+"</div>"+$.sq_config.after_insert}if(as==="link"){content='<a href="'+parent.attr("href")+'" title="'+parent.attr("header")+'" style="font-style:italic;color: #333;">'+decodeURIComponent(parent.attr("href"))+"</a>"}return content};$this.formatDate=function(date){var mm=date.getMonth()+1;var dd=date.getDate();var yyyy=date.getFullYear();mm=mm<10?"0"+mm:mm;return mm+"."+dd+"."+yyyy};$this.showTypeHelp=function(type){$this.find(".sq_type_help").hide();$this.find(".sq_type_"+type+"_help").show()};$this.cancelSearch=function(){if(settings.ajaxCall){settings.ajaxCall.abort()}};$this.refreshSearch=function(type){settings.type=type;$this.cancelSearch();$this.getSearch(type,0)};$this.previewBlog=function(parent,filter){if($.sq_fields.sq_blog_preview===null)return;$.post($.sq_config.ajaxurl,{action:"sla_preview",sq_nonce:$.sq_config.sq_nonce,filter:filter?"&filter=1":"&filter=0",link:parent.attr("href"),output:"json"}).done(function(response){if(typeof response.error!=="undefined"){$.sq_fields.sq_blog_preview.removeClass("sq_error").sq_doneloading("sq_loading");$.sq_fields.sq_blog_preview.attr("href",response.link);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_title").html($.sq_config.__nofound);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_body").html($.sq_config.__nofound)}else if(typeof response.data!=="undefined"&&response.data.content!==""){$.sq_fields.sq_blog_preview.removeClass("sq_error").sq_doneloading("sq_loading");$.sq_fields.sq_blog_preview.attr("href",response.link);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_title").html(response.data.title);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_body").html(response.data.content);$.sq_fields.sq_blog_preview.find("#sq_blog_preview_body p").each(function(){$(this).removeClass()});var ptext;$.sq_fields.sq_blog_preview.find(".sq_blog_option").off("click").on("click",function(){ptext=$(this).parent("p").clone();ptext=ptext.find(".sq_blog_option").remove();ptext=ptext.end().html();if($.sq_isGutenberg()){var sq_block=wp.blocks.createBlock("core/html",{content:ptext+$this.packblog($.sq_fields.sq_blog_preview,"reference")});var ed=$.sq_editor.getBlockEditor("dispatch");if(ed)ed.insertBlock(sq_block,undefined);$("#block-"+sq_block.clientId).find(".editor-block-toolbar").find("button").trigger("click")}else{$.sq_editor.insert(ptext+$this.packblog($.sq_fields.sq_blog_preview,"reference"))}});$.sq_fields.sq_blog_preview.find("#sq_blog_preview_body a").each(function(){$(this).attr("target","_blank")});$.sq_fields.sq_blog_preview.find(".editsection").hide()}else{$.sq_fields.sq_blog_preview.remove()}}).fail(function(){$.sq_fields.sq_blog_preview.remove()})};$this.showNotOptimized=function(){$.sq_fields.sq_keyword_nokeyword.show()};$this.hideNotOptimized=function(){$("#sq_publish_alert").hide()};$this.hideOptions=function(){$this.cancelSearch();if(settings.timeout){clearTimeout(settings.timeout);clearTimeout(settings.calltime)}if(settings.gtimeout){clearTimeout(settings.gtimeout)}};$this.prepareParam=function(response,keyword){var j;var param={rank:-1,note:-1,stats:[]};if($.sq_isArray(response)){var responselen=response.length;for(j=0;j<responselen;j++){if($.sq_strEqual(keyword,response[j].keyword)){param.rank=response[j].stats.rank.value;param.note=response[j].note;param.stats=[response[j].stats.tw,response[j].stats.sv,response[j].stats.sc,response[j].stats.td];break}}}return param};$this.addTag=function(){if($.sq_config.sq_keywordtag==1){$("#new-tag-post_tag").val($.sq_config.keyword);$("input.tagadd").trigger("click")}};$this.sq_eventssearch={checkKeywordSet:function(){if($.sq_fields.sq_keyword.val()!==""){$.sq_config.keyword=$.sq_fields.sq_keyword.val();$.sq_fields.sq_selectit.trigger("click");$.sq_fields.sq_keyword_score.html("0%");$.sq_fields.sq_keyword_div.show();if($.sq_config.firsttime){$.sq_fields.sq_box_maximize.trigger("click")}}if($.sq_config.keyword===""&&$(".sq_snippet_keywords").length>0){var snipet_keywords=$(".sq_snippet_keywords").text().split(",");if(snipet_keywords.length>0){$.sq_config.keyword=snipet_keywords[0];$.sq_fields.sq_keyword.val($.sq_config.keyword);$.sq_fields.sq_selectit.trigger("click")}}if($.sq_config.keyword===""){$this.hideTypes();$this.hideOptions();$this.showNotOptimized()}$this.initialFieldValue($.sq_fields.sq_keyword,"black","gray");$.sq_fields.div_blockseo.trigger("seo.keyword_loaded")},listen:function(){$.post($.sq_config.ajaxurl,{action:"sla_keywords",sq_nonce:$.sq_config.sq_nonce,post_id:$.sq_config.postID}).done(function(response){if(typeof $.sq_fields.sq_keyword==="undefined"){$.sq_setfields()}if(typeof response.data!=="undefined"){if(typeof response.data.keyword!=="undefined"){if(response.data.keyword===null){$.sq_config.firsttime=true;$this.sq_eventssearch.checkKeywordSet()}else{$.sq_config.firsttime=false;if($.sq_fields.sq_keyword.val()===""){$.sq_fields.sq_keyword.val(decodeURIComponent(response.data.keyword))}$this.sq_eventssearch.checkKeywordSet()}}}$.sq_fields.sq_preloading_keyword.hide();$.sq_fields.sq_blocktabs.show();$.sq_fields.div_blockbriefacse.show();$this.trigger("seo.keyword_loaded")}).fail(function(error){$.sq_fields.sq_preloading.show()});$.sq_fields.sq_keyword.on("keypress",function(event){if(event.keyCode===$.ui.keyCode.ENTER){$.sq_fields.sq_keyword_check.trigger("click")}return event.keyCode!==$.ui.keyCode.ENTER});$.sq_fields.sq_keyword.on("keyup",function(event){if(event.keyCode!==$.ui.keyCode.ENTER&&event.keyCode!==$.ui.keyCode.UP&&event.keyCode!==$.ui.keyCode.DOWN&&event.keyCode!==$.ui.keyCode.ESCAPE){if($.sq_fields.sq_keyword.val()!==""&&$.sq_config.keyword!==$.sq_clearText($.sq_fields.sq_keyword.val())){if($.sq_fields.sq_keyword.val()!==""){$.sq_config.keyword=$.sq_fields.sq_keyword.val();$.sq_blockseo.checkKeyword();$this.init()}else{$this.hideOptions()}$this.hideSearch()}}else if(event.keyCode===$.ui.keyCode.ESCAPE){if($.sq_fields.sq_keyword.val()!==""){$this.hideOptions()}}});$.sq_fields.sq_keyword.on("click",function(){if($.sq_fields.sq_keyword.val()===""){$this.hideOptions()}});$.sq_fields.sq_keyword_check.off("click").on("click",function(){if($.sq_fields.sq_keyword.val()!==""){$.sq_fields.sq_selectit.trigger("click")}});$.sq_fields.sq_selectit.off("click").on("click",function(){$.sq_config.manual=true;$("#sq_keyword_second").val("");if($.sq_fields.sq_keyword.val()!==""){$.sq_config.keyword=$.sq_fields.sq_keyword.val()}if($.sq_config.keyword!==""){if($("#sq_blocksnippet").find("input[name=sq_keyword]").length){$("#sq_blocksnippet").find("input[name=sq_keyword]").val($.sq_config.keyword)}$this.showTypes();$.sq_blockseo.load();$this.trigger("seo.keyword_selected");$(".sq_request_highlight_key").html($.sq_config.keyword);$.sq_fields.sq_types.find("li:first").trigger("click");$this.hideNotOptimized()}if($.sq_fields.wp_content_wrap.length>0){if($.sq_fields.wp_content_wrap.attr("class").indexOf("html-active")==-1){$this.showActiveEditor()}}});$.sq_fields.sq_type_img.off("click").on("click",function(){$.sq_fields.sq_types.find("li").removeClass("sq_active");$(this).addClass("sq_active");$this.showTypeHelp("img");$this.refreshSearch("img")});$.sq_fields.sq_type_twitter.off("click").on("click",function(){$.sq_fields.sq_types.find("li").removeClass("sq_active");$(this).addClass("sq_active");$this.showTypeHelp("twitter");$this.refreshSearch("twitter")});$.sq_fields.sq_type_news.off("click").on("click",function(){$.sq_fields.sq_types.find("li").removeClass("sq_active");$(this).addClass("sq_active");$this.showTypeHelp("twitter");$this.refreshSearch("news")});$.sq_fields.sq_type_blog.off("click").on("click",function(){$.sq_fields.sq_types.find("li").removeClass("sq_active");$(this).addClass("sq_active");$this.showTypeHelp("blog");$this.refreshSearch("blog")});$.sq_fields.sq_type_wiki.off("click").on("click",function(){$.sq_fields.sq_types.find("li").removeClass("sq_active");$(this).addClass("sq_active");$this.showTypeHelp("wiki");$this.refreshSearch("wiki")});$.sq_fields.sq_type_local.off("click").on("click",function(){$.sq_fields.sq_types.find("li").removeClass("sq_active");$(this).addClass("sq_active");$this.showTypeHelp("local");$this.refreshSearch("local")});$.sq_fields.sq_search_img_nolicence.off("click").on("click",function(){var licence=1;if($.sq_fields.sq_search_img_nolicence.is(":checked")){$("#sq_search_img_nolicence_label").attr("class","checked");licence=1}else{$("#sq_search_img_nolicence_label").removeClass("checked");licence=0}$this.refreshSearch("img")});$(".wp-switch-editor").on("click",function(){if(this.id.indexOf("tmce")!==-1){$this.sq_eventssearch.listenMCE()}else{$this.sq_eventssearch.listenHTML()}});$("#qt_content_fullscreen, .mce-i-wp_fullscreen").on("click",function(){$(".mce-btn").find("i").on("click",function(){$this.sq_eventssearch.listenMCE()});$(".wp-fullscreen-mode-tinymce").on("click",function(){$this.sq_eventssearch.listenMCE();$(".media-modal").find("a").on("click",function(){$this.sq_eventssearch.listenMCE()})});$(".wp-fullscreen-mode-html").on("click",function(){$this.sq_eventssearch.listenHTML();$(".media-modal").find("a").on("click",function(){$this.sq_eventssearch.listenHTML()})})});$("#wp-fullscreen-close, .mce-i-bold, .media-button").find("a").on("click",function(){if($.sq_fields.wp_content_wrap.length>0&&$.sq_fields.wp_content_wrap.attr("class").indexOf("html-active")!==-1){$.sq_blockseo.sq_eventsseo.listenHtml()}else{$.sq_blockseo.sq_eventsseo.listenTinymce()}})},listenMCE:function(){$this.showActiveEditor();$.sq_blockseo.sq_eventsseo.stopListenHtml();$.sq_blockseo.sq_eventsseo.listenTinymce();$.sq_fields.sq_selectit.trigger("click")},listenHTML:function(){$.sq_blockseo.sq_eventsseo.stopListenTinymce();$.sq_blockseo.sq_eventsseo.listenHtml();$.sq_fields.sq_selectit.trigger("click")}};$this.one("seo.loaded",function(){$.sq_config.debug&&console.log("sq_blocksearch seo.loaded");$this.sq_eventssearch.listen()});return $this}})(jQuery);